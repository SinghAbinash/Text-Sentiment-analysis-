<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Analyzer</title>
    <style>
        /* --- Base Styles (Desktop) --- */
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            max-width: 800px; 
            margin: 2rem auto; 
            padding: 0 1rem; 
            background-color: #f4f4f9; 
        }
        .container { 
            background: white; 
            padding: 2rem; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        h1 { font-size: 1.5rem; margin-top: 0; color: #333; }
        
        textarea { 
            width: 100%; 
            height: 120px; 
            padding: 12px; 
            margin-bottom: 15px; 
            border: 1px solid #ccc; 
            border-radius: 8px; 
            box-sizing: border-box; /* Ensures padding doesn't break width */
            font-size: 16px; /* Prevents zooming on iPhone */
            resize: vertical;
        }

        /* Flexbox for Buttons */
        .btn-group { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        
        button { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: 500;
            transition: background 0.2s;
        }
        button:hover { background-color: #0056b3; }

        /* Download Button (Green) */
        #downloadBtn { background-color: #28a745; display: none; }
        #downloadBtn:hover { background-color: #218838; }

        /* Results */
        .result-box { 
            margin-top: 20px; 
            padding: 20px; 
            border-radius: 8px; 
            display: none; 
            text-align: center;
        }
        .Positive { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .Negative { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .Neutral { background-color: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; }

        /* Table Styles */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #555; font-weight: 600; }
        
        .score-pos { color: #28a745; font-weight: bold; }
        .score-neg { color: #dc3545; font-weight: bold; }
        .score-neu { color: #6c757d; }

        /* --- Mobile Responsive Styles --- */
        @media (max-width: 600px) {
            body {
                padding: 10px; /* Smaller outer gap */
                margin: 0 auto;
            }
            .container {
                padding: 1.5rem 1rem; /* Less padding inside white box */
                border-radius: 8px;
            }
            
            /* Stack buttons vertically on mobile */
            .btn-group {
                flex-direction: column;
                gap: 10px;
            }
            button {
                width: 100%; /* Full width buttons */
                padding: 15px; /* Larger touch target */
            }

            /* Adjust table for small screens */
            th, td {
                padding: 8px 5px; /* Tighter cells */
                font-size: 14px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>TextBlob Sentiment</h1>
    <p>Analyze the emotion of your text instantly.</p>
    
    <textarea id="textInput" placeholder="Type or paste your text here..."></textarea>
    
    <div class="btn-group">
        <button onclick="analyzeText()">Analyze Text</button>
        <button id="downloadBtn" onclick="downloadReport()">Download Report</button>
    </div>

    <div id="overallResult" class="result-box">
        <h2 style="margin:0">Overall: <span id="mainLabel"></span></h2>
        <p style="margin:5px 0 0 0">Score: <span id="mainScore"></span></p>
    </div>

    <table id="wordTable" style="display:none;">
        <thead>
            <tr>
                <th>Word</th>
                <th>Score</th>
                <th>Label</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    let currentData = null;

    async function analyzeText() {
        const text = document.getElementById('textInput').value;
        if(!text.trim()) return; // Don't run if empty

        // Show loading state
        const btn = document.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = "Analyzing...";
        
        try {
            const response = await fetch('/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text })
            });
            
            const data = await response.json();
            currentData = data;

            // Update Overall Section
            const resBox = document.getElementById('overallResult');
            resBox.style.display = 'block';
            resBox.className = 'result-box ' + data.overall_label; 
            document.getElementById('mainLabel').innerText = data.overall_label;
            document.getElementById('mainScore').innerText = data.overall_score.toFixed(2);

            // Show Download Button
            document.getElementById('downloadBtn').style.display = 'block';

            // Update Word Table
            const table = document.getElementById('wordTable');
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = ''; 
            table.style.display = 'table';

            data.words.forEach(item => {
                let scoreClass = 'score-neu';
                if(item.score > 0) scoreClass = 'score-pos';
                if(item.score < 0) scoreClass = 'score-neg';

                const row = `<tr>
                    <td>${item.word}</td>
                    <td class="${scoreClass}">${item.score.toFixed(2)}</td>
                    <td>${item.label}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        } catch (error) {
            alert("Error connecting to server.");
        } finally {
            btn.innerText = originalText;
        }
    }

    function downloadReport() {
        if (!currentData) return;
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Type,Value\n";
        csvContent += `Overall Sentiment,${currentData.overall_label}\n`;
        csvContent += `Overall Score,${currentData.overall_score}\n\n`;
        csvContent += "Word,Score,Label\n";
        currentData.words.forEach(row => {
            csvContent += `"${row.word}",${row.score},${row.label}\n`;
        });
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "sentiment_report.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>

</body>
</html>